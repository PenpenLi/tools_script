<?php
	$docFile = getDictionaryFile("./protobuf/", ".proto");
	
	foreach($docFile as $fileName)
	{
		$output = shell_exec("protoc --proto_path=./protobuf  --cpp_out=../protobuf protobuf/".$fileName);
	}
	
	function getDictionaryFile($dir, $search) {
		$handler = opendir($dir);
		while (($filename = readdir($handler)) !== false) {
			if ($filename != "." && $filename != ".." && strpos($filename, $search)) {
				$files[] = $filename;
			}
		}

		closedir($handler);
		return $files;
	}

	$headerFiles = getDictionaryFile("../protobuf/", "pb.h");
	//print_r($headerFiles);

	$outputStr = "// Do not edit this file!! this file created by php script!!\n";
	$outputStr .= "#ifndef HiFly_ProtobufMsg_h\n";
	$outputStr .= "#define HiFly_ProtobufMsg_h\n";


	foreach ($headerFiles as $tmpFile) {
		$outputStr .= '#include "' . $tmpFile . '"' . "\n";
	}

	$outputStr .= "using namespace protobuf;\n";

	$outputStr .= "#endif\n";

	// create new export header file that include all proto header files
	$exportHeaderFile = fopen("../protobuf/ProtobufMsg.h", "w");

	fwrite($exportHeaderFile, $outputStr);

	fclose($exportHeaderFile);

	echo "creat header file: ../protobuf/ProtobufMsg.h";
?>

